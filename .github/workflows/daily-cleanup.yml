name: Daily Cleanup of Expired Reservations

on:
  schedule:
    # Run daily at 09:00 UTC (10:00 CET, 11:00 CEST)
    - cron: '0 9 * * *'
  workflow_dispatch: # Allow manual trigger

jobs:
  cleanup:
    runs-on: ubuntu-latest
    name: Clean Expired Reservations
    steps:
      - name: Call Azure Function
        run: |
          curl -X POST \
            -H "Content-Type: application/json" \
            -H "x-auth-key: ${{ secrets.CLEANUP_AUTH_KEY }}" \
            -d '{"trigger": "scheduled"}' \
            https://red-dune-0966b1410.1.azurestaticapps.net/api/cleanup-expired-reservations \
            -w "HTTP Status: %{http_code}\nResponse Time: %{time_total}s\n" \
            -s -S